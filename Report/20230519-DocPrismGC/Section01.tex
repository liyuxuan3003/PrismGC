\section{系统设计}

\subsection{系统总体框图}

系统总体框图如\xref{fig:系统总体框图}所示，以安路科技EG4S20BG256的FPGA芯片为中心
\begin{itemize}
    \item 显示屏：实现画面输出，分辨率$1024\times 600$，使用HDMI进行连接。
    \item 蜂鸣器：实现音频输出，可以控制音符的长度和音高。
    \item WII手柄：实现体感控制，具有加速度传感器和若干按钮，使用IIC协议。
    \item 键盘：实现按键输入，具有$4\times 4$共16个按键。
    \item 七段数码管：共$4$个，用于数字显示。
    \item 发光二极管：共$8$个，用于系统调试。
    \item 开关：共$8$个，用于系统调试。
\end{itemize}

\begin{Figure}[系统总体框图]
    \includegraphics{build/Section01_01.fig.pdf}
\end{Figure}

\subsection{系统完成进度}

系统完成进度目前约70\%，可以完整运行，后期将着重优化系统各部分功能。

显示部分，目前已经成功地在FPGA上实现了HDMI协议，可以点亮屏幕。并且成功地利用了FPGA片上的SDRAM资源作为显存，可以实现Cortex M0对显示屏的单像素控制。同时在显存使用上应用了双缓存机制，避免了显示刷新过程中的闪烁问题。后续，硬件方面将改善显存的写入速度，提高画面帧率。软件方面将会实现字符显示功能，丰富游戏画面内容和用户交互体验。

音频部分，目前可以利用蜂鸣器发出特定音高和音长的音符，在Cortex M0的控制下，可以根据游戏进程播放不同的提示音，可以播放简单的背景音乐。后续，将在硬件增加音频缓冲区，使得音乐播放更为灵活，在软件提供音乐内容后由硬件独立完成。

输入部分，目前可以利用矩阵键盘中的按键实现对游戏的控制。WII手柄目前已经在Arduino平台上完成测试，可以正确感知手柄按钮和加速度等信息，WII手柄向FPGA的移植目前仍在进行中，计划在复赛中完成，现已初步完成IIC协议的实现。